<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ux/layout/masonry.mjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ux/layout/masonry.mjs</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Loads posts into a masonry layout
 * @uses waitForImages to wait until the images are loaded before completing the masonry layout
 * @uses masonryOnChange to reload the masonry layout on load or resize events
 * @uses resizeAllMasonryItems to build the masonry layout
 */
export function masonry() {
  waitForImages();
  masonryOnChange();
  resizeAllMasonryItems();
}

/**
 * Reloads the masonry layout on load and resize events
 * @uses resizeAllMasonryItems to make the masonry layout
 */
function masonryOnChange() {
  const masonryEvents = ["load", "resize"];
  masonryEvents.forEach((event) => {
    window.addEventListener(event, resizeAllMasonryItems);
  });
}

/**
 * Waits for the images to load befor resizes the masonry-items
 *
 * @uses ImagesLoaded from https://imagesloaded.desandro.com/ (CDN added to HTML)
 * @uses resizeMasonryItem To make the masonry layout
 */
export function waitForImages() {
  const allDisplayedPosts = document.getElementsByClassName("media-masonry-brick");
  for (var i = 0; i &lt; allDisplayedPosts.length; i++) {
    imagesLoaded(allDisplayedPosts[i], (posts) => {
      const imagePosts = posts.elements[0];
      resizeMasonryItem(imagePosts);
    });
  }
}

/**
 * Resizes the masonry layout when an accordion-element on open and close events
 * @param {string} accordion An accordion-element
 * @uses masonry To load the masonry layout
 * */
function accordionResize(accordion) {
  accordion.forEach((accordionelement) => {
    accordionelement.addEventListener("hidden.bs.collapse", () => {
      masonry();
    });
    accordionelement.addEventListener("shown.bs.collapse", () => {
      masonry();
    });
  });
}

/**
 * Runs the accordionResize function on each of the accordions.
 * @uses accordionResize Resizes the masonry layout when an accordion-element on open and close events
 * */
export function runMasonryOnAccordion() {
  const accordions = document.getElementsByClassName("detect-collapse");
  let accordionsArray = [...accordions];
  accordionResize(accordionsArray);
}

/**
 * Function and documentation for masonry layout lent from: https://w3bits.com/css-grid-masonry/#google_vignette
 *
 * Set appropriate spanning to any masonry item
 *
 * Get different properties we already set for the masonry, calculate height or spanning for any cell of the masonry grid based on its
 * content-wrapper's height, the (row) gap of the grid, and the size of the implicit row tracks.
 *
 * @param {object} masonrycell A brick/tile/cell inside the masonry
 */
export function resizeMasonryItem(masonrycell) {
  /* Get the grid object, its row-gap, and the size of its implicit rows */
  var grid = document.getElementsByClassName("masonry")[0],
    rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue("grid-row-gap")),
    rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue("grid-auto-rows"));

  /*
   * Spanning for any brick = S
   * Grid's row-gap = G
   * Size of grid's implicitly create row-track = R
   * Height of item content = H
   * Net height of the item = H1 = H + G
   * Net height of the implicit row-track = T = G + R
   * S = H1 / T
   */
  var rowSpan = Math.ceil((masonrycell.querySelector(".masonry-content").getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));
  
  /* Set the spanning as calculated above (S) */
  masonrycell.style.gridRowEnd = "span " + rowSpan;
}

/**
 * Function and documentation for masonry layout lent from: https://w3bits.com/css-grid-masonry/#google_vignette
 *
 * Apply spanning to all the masonry items
 * Loop through all the items and apply the spanning to them using `resizeMasonryItem()` function.
 * @uses resizeMasonryItem
 */
export function resizeAllMasonryItems() {
  // Get all item class objects in one list
  var allItems = document.getElementsByClassName("masonry-brick");

  /* Loop through the above list and execute the spanning function to each list-item (i.e. each masonry item)*/
  for (var i = 0; i &lt; allItems.length; i++) {
    resizeMasonryItem(allItems[i]);
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#accordionResize">accordionResize</a></li><li><a href="global.html#commentsHTML">commentsHTML</a></li><li><a href="global.html#displayCommentsAccordion">displayCommentsAccordion</a></li><li><a href="global.html#displayReactionsAccordion">displayReactionsAccordion</a></li><li><a href="global.html#insertUrlParam">insertUrlParam</a></li><li><a href="global.html#masonry">masonry</a></li><li><a href="global.html#masonryOnChange">masonryOnChange</a></li><li><a href="global.html#openPostAsModal">openPostAsModal</a></li><li><a href="global.html#postTemplate">postTemplate</a></li><li><a href="global.html#reactionsHTML">reactionsHTML</a></li><li><a href="global.html#removeModalFromDOM">removeModalFromDOM</a></li><li><a href="global.html#removeUrlParameter">removeUrlParameter</a></li><li><a href="global.html#renderPostBody">renderPostBody</a></li><li><a href="global.html#renderPostFooter">renderPostFooter</a></li><li><a href="global.html#renderPostHeader">renderPostHeader</a></li><li><a href="global.html#renderPostTemplate">renderPostTemplate</a></li><li><a href="global.html#renderPostTemplates">renderPostTemplates</a></li><li><a href="global.html#resizeAllMasonryItems">resizeAllMasonryItems</a></li><li><a href="global.html#resizeMasonryItem">resizeMasonryItem</a></li><li><a href="global.html#runMasonryOnAccordion">runMasonryOnAccordion</a></li><li><a href="global.html#waitForImages">waitForImages</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Mar 10 2024 19:52:42 GMT+0700 (Indochina Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
